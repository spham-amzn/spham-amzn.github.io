<!doctype html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Running robotic simulations using Docker Images // Steve&#39;s O3DE Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.138.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Steve Pham" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.8a5f1f9a3b69d6f86bc8978d5f50a10b6ba39af98f7240aa11903459a154baee.css" />
    

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Running robotic simulations using Docker Images">
  <meta name="twitter:description" content="Distributing Simulation Projects For robotics simulation projects for ROS2 and O3DE, collaboration on constructing and refining the simulation can be shared across a team through source control such as GIT or Perforce. However, in order iterate through developing the simulation, O3DE, ROS2, and its environment and dependencies need to be installed separately in order to access and contribute to the project. I explained how Amazon’s EC2 helps with the environment through a marketplace AMI in my previous blog post.">

    <meta property="og:url" content="http://localhost:1313/posts/o3de-ros2-containerize-simulation/">
  <meta property="og:site_name" content="Steve&#39;s O3DE Blog">
  <meta property="og:title" content="Running robotic simulations using Docker Images">
  <meta property="og:description" content="Distributing Simulation Projects For robotics simulation projects for ROS2 and O3DE, collaboration on constructing and refining the simulation can be shared across a team through source control such as GIT or Perforce. However, in order iterate through developing the simulation, O3DE, ROS2, and its environment and dependencies need to be installed separately in order to access and contribute to the project. I explained how Amazon’s EC2 helps with the environment through a marketplace AMI in my previous blog post.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-16T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-16T00:00:00+00:00">
    <meta property="article:tag" content="AWS">
    <meta property="article:tag" content="Simulation">
    <meta property="article:tag" content="Robotics">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="ROS">


  </head>
  <body>
    <header class="app-header">
      <a href="http://localhost:1313/"><img class="app-header-avatar" src="/images/spham-amzn.png" alt="Steve Pham" /></a>
      <span class="app-header-title">Steve&#39;s O3DE Blog</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Welcome to my blog. This is a place to discuss all things related to O3DE.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/spham-amzn" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-github" viewBox="0 0 24 24" fill="currentColor"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          </a>
        
          <a href="https://www.linkedin.com/in/steve-pham-69a7142/" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-linkedin" viewBox="0 0 24 24" fill="currentColor"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Running robotic simulations using Docker Images</h1>
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Dec 16, 2024
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          11 min read
        </div>
        <div>
          <svg class="icon icon-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
              <a class="tag" href="http://localhost:1313/tags/aws/">AWS</a>
              <a class="tag" href="http://localhost:1313/tags/simulation/">Simulation</a>
              <a class="tag" href="http://localhost:1313/tags/robotics/">Robotics</a>
              <a class="tag" href="http://localhost:1313/tags/docker/">Docker</a>
              <a class="tag" href="http://localhost:1313/tags/ros/">ROS</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="distributing-simulation-projects">Distributing Simulation Projects</h1>
<p>For robotics simulation projects for ROS2 and O3DE, collaboration on constructing and refining the simulation can be shared across a team through source control such as GIT or Perforce. However, in order iterate through developing the simulation, O3DE, ROS2, and its environment and dependencies need to be installed separately in order to access and contribute to the project. I explained how Amazon&rsquo;s EC2 helps with the environment through a marketplace AMI in my previous blog post.</p>
<p>The primary goal of simulations is for training robots through ROS2, not through O3DE. Once the simulation is ready for use, O3DE itself is not needed to run the simulation. The simulation project can be exported into a launcher application separate from O3DE&rsquo;s Editor and build environment. Exporting a simulation project into its own launcher will package just the launcher executable and its bare minimum dependent binaries, assets, and necessary settings needed to launch the simulation. All the additional Editor and Asset Processor related artifacts that comes with a full O3DE installation will be omitted.</p>
<h3 id="containerization">Containerization</h3>
<p>The exported project alone usually is not enough to have it run on different machines. Along with the base operating system (in this case, Ubuntu Linux) there are additional pre-requisite package requirements. In order to have the simulation project run consistently across different machines, each machine must have the same operating system, packages, and environment. Another approach to utilize containerization.</p>
<p>Containerization provides many benefits for our use case:</p>
<h4 id="portability">Portability</h4>
<p>The simulation project will be contained in its own isolated environment and operating system. The specific operating system, Ubuntu 22.04, and all of its required packages will be embedded in the container image and isolated from the host machine. That means no additional simulation-specific pre-requisites are needed to launch the simulation. This allows it to run on multiple devices and operating systems.</p>
<h4 id="consistency">Consistency</h4>
<p>Container images are immutable. This ensures that the application will run in a consistent manner across any environment or operating system.</p>
<h4 id="scalability">Scalability</h4>
<p>Containers are lightweight and run efficiently. Unlike virtual machines, they do not need to be boot up to load the operating system. Containers can be distributed and managed easily through different container orchestration tools as well.</p>
<p>We will be using the same simulation project we created from my previous blog in this example.</p>
<h2 id="exporting-the-project">Exporting the Project</h2>
<p>Once the simulation project is working as expected through the Editor and from command line, we can use the O3DE to export the project to a single folder. Through the Project Manager, click on the context button for the project <strong>MyRobotSimulation</strong> and click on <strong>Open Export Settings&hellip;</strong></p>
<p><img src="/images/blog/o3de-ros2-export-project/project-manager-context.png" alt="O3DE Project Manager"></p>
<p>This will bring up the export settings specific to this project. This is where we will configure the settings we need to export just the simulation (game) launcher.</p>
<p><img src="/images/blog/o3de-ros2-export-project/export_settings.png" alt="Export Setting"></p>
<p>The export settings is designed for any type of project, not just simulations. There will only be a few settings that we need to enable and configure for our simulation launcher:</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th></th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Project Build Configuration</strong></td>
          <td></td>
          <td>profile</td>
      </tr>
      <tr>
          <td><strong>Build Assets</strong></td>
          <td></td>
          <td>true</td>
      </tr>
      <tr>
          <td><strong>Level Names</strong></td>
          <td></td>
          <td>DemoLevel</td>
      </tr>
      <tr>
          <td><strong>Max Size</strong></td>
          <td></td>
          <td>2048</td>
      </tr>
      <tr>
          <td><strong>Asset Bundling Path</strong></td>
          <td></td>
          <td>build/asset_bundling</td>
      </tr>
      <tr>
          <td><strong>Archive Format</strong></td>
          <td></td>
          <td>none</td>
      </tr>
      <tr>
          <td><strong>Build Game Launcher</strong></td>
          <td></td>
          <td>true</td>
      </tr>
      <tr>
          <td><strong>Build Server Launcher</strong></td>
          <td></td>
          <td>false</td>
      </tr>
      <tr>
          <td><strong>Build Unified Launcher</strong></td>
          <td></td>
          <td>false</td>
      </tr>
      <tr>
          <td><strong>Build Headless Server Launcher</strong></td>
          <td></td>
          <td>false</td>
      </tr>
  </tbody>
</table>
<p>Once the configuration is set, click on <strong>Save</strong> to save the settings. To run the project export, click on the context menu button for the project again, and click on <strong>Export Launcher</strong>-&gt;<strong>Linux</strong></p>
<p><img src="/images/blog/o3de-ros2-export-project/export-launcher-linux.png" alt="Export Linux"></p>
<p>When the process is complete, the exported project will be located in folder named <strong>MyRobotSimulationGamePackage</strong> in the path <strong>~/O3DE/Projects/MyRobotSimulation/build/export/</strong></p>
<h1 id="creating-a-docker-image">Creating a Docker Image</h1>
<p>The exported project can now be stored into a compressed archive and distributed to other Ubuntu 22.04 hosts to use. However, in order to run the project successfully, they must conform to the same general requirements for O3DE and ROS2. This means that the runtime environment must closely match the same environment as O3DE (minus the build tools). Another approach to distribution is to use containerization. Containers gives us a portable and consistent mechanism to distribute and execute our simulation across different machines and environments.</p>
<p>For this blog, we will use <a href="https://www.docker.com/">Docker</a> and the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker">NVIDIA Container toolkit</a>.</p>
<h3 id="installing-docker-engine">Installing Docker Engine</h3>
<p>Install Docker Engine for Ubuntu using the <a href="https://docs.docker.com/engine/install/ubuntu/">Docker Installation instructions</a>. The following is a quick cheat-sheet to install Docker Engine using the <strong>apt</strong> repository based on the <a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">Dockers&rsquo;s apt instructions</a>.</p>
<h4 id="1-set-up-dockers-apt-repository">1. Set up Docker&rsquo;s <strong>apt</strong> repository</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Add Docker&#39;s official GPG key:</span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install ca-certificates curl
</span></span><span style="display:flex;"><span>sudo install -m <span style="color:#ae81ff">0755</span> -d /etc/apt/keyrings
</span></span><span style="display:flex;"><span>sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
</span></span><span style="display:flex;"><span>sudo chmod a+r /etc/apt/keyrings/docker.asc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Add the repository to Apt sources:</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">&#34;deb [arch=</span><span style="color:#66d9ef">$(</span>dpkg --print-architecture<span style="color:#66d9ef">)</span><span style="color:#e6db74"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  </span><span style="color:#66d9ef">$(</span>. /etc/os-release <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span>$VERSION_CODENAME<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74"> stable&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span></code></pre></div><h4 id="2-install-the-docker-packages">2. Install the Docker packages</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span></code></pre></div><h4 id="3-create-a-docker-group-if-not-already-created-add-the-current-user-to-the-docker-group">3. Create a <strong>docker</strong> group (if not already created) Add the current user to the <strong>docker</strong> group</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo groupadd docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo usermod -aG docker $USER
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>newgrp docker
</span></span></code></pre></div><h4 id="4-verify-that-you-can-run-docker-without-sudo-by-running-the-hello-world-image">4. Verify that you can run docker without sudo by running the hello-world image.</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run hello-world
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> If you run into any issues during these steps, refer to the <a href="https://docs.docker.com/engine/install/ubuntu/">Docker Installation instructions</a> for help.</p>
</blockquote>
<h3 id="installing-nvidia-container-toolkit">Installing NVIDIA Container Toolkit</h3>
<p>In addition to Docker Engine, you will need the NVIDIA Container toolkit in order to run the simulation within the Docker Image. The following is another quick cheat-sheet to installing the toolkit based on <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-with-apt">NVIDIA&rsquo;s apt instructions</a>.</p>
<h4 id="1-set-up-nvidias-production-repository">1. Set up NVIDIA&rsquo;s production repository</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#f92672">&amp;&amp;</span> curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    sed <span style="color:#e6db74">&#39;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#39;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
</span></span></code></pre></div><h4 id="2-update-the-package-list-from-the-repository">2. Update the package list from the repository</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get update
</span></span></code></pre></div><h4 id="3-install-the-toolkit-from-apt">3. Install the toolkit from apt</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get install -y nvidia-container-toolkit
</span></span></code></pre></div><h4 id="4-configure-the-toolkit-for-docker-rootless">4. Configure the toolkit for Docker (rootless)</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nvidia-ctk runtime configure --runtime<span style="color:#f92672">=</span>docker --config<span style="color:#f92672">=</span>$HOME/.config/docker/daemon.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl --user restart docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo nvidia-ctk config --set nvidia-container-cli.no-cgroups --in-place
</span></span></code></pre></div><h3 id="create-the-docker-image">Create the Docker Image</h3>
<p>A <strong>Dockerfile</strong> is the recipe for the docker engine to build a Docker Image. The Docker Image will include the minimal required packages for O3DE launchers and ROS2, based on the type of simulation that <strong>MyRobotSimulation</strong> was built for. Docker uses a path to refer to as its context root, and in our example, we will use the path to the exported project from earlier (<strong>~/O3DE/Projects/MyRobotSimulation/build/export/</strong>).</p>
<h4 id="1-create-a-dockerfile">1. Create a Dockerfile</h4>
<p>Navigate to the path <strong>~/O3DE/Projects/MyRobotSimulation/build/export/</strong> and create a file named <strong>Dockerfile</strong> with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-docker" data-lang="docker"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># This image will be based on ROS&#39;s ros humble base image</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ros:humble-ros-base-jammy</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> WORKSPACE<span style="color:#f92672">=</span>/data/workspace<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> $WORKSPACE</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get upgrade -y<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Get the necessary packages needed for the simulation launcher</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get install -y --no-install-recommends libglu1-mesa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libfontconfig1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-image0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-keysyms1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-render-util0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-randr0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-xinerama0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-xinput0 <span style="color:#ae81ff">\ </span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>                       libxcb-xkb1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxcb-xfixes0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libxkbcommon-x11-0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libunwind8 <span style="color:#ae81ff">\ </span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>                       libxcb-icccm4 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       libnvidia-gl-470 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-slam-toolbox <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-navigation2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-nav2-bringup <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-pointcloud-to-laserscan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-gazebo-msgs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-ackermann-msgs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-rmw-cyclonedds-cpp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-control-toolbox <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                       ros-<span style="color:#e6db74">${</span>ROS_DISTRO<span style="color:#e6db74">}</span>-nav-msgs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm -rf /var/lib/apt/lists/* <span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy over the exported project into this image</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> MyRobotSimulationGamePackage $WORKSPACE/Simulation<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Enable the necessary environments for the NVIDIA toolkit and ROS2</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> NVIDIA_VISIBLE_DEVICES<span style="color:#f92672">=</span>all
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ENV</span> NVIDIA_DRIVER_CAPABILITIES<span style="color:#f92672">=</span>all
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ENV</span> RMW_IMPLEMENTATION<span style="color:#f92672">=</span>rmw_cyclonedds_cpp 
</span></span></code></pre></div><h4 id="2-build-the-docker-image">2. Build the docker image</h4>
<p>Once the Dockerfile recipe is saved, you can use the Docker Engine to build an OCI-compliant container image. We will name the image <strong>my_robot_simulation</strong> (Docker is case sensitive and does not allow for mixed casing in the name) and use the <strong>latest</strong> tag for our sample.</p>
<p>Use the following command to build the image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker build -t my_robot_simulation:latest ~/O3DE/Projects/MyRobotSimulation/build/export
</span></span></code></pre></div><h4 id="3-test-the-docker-image-locally">3. Test the docker image locally</h4>
<p>Before uploading and distributing the Docker Image, we will test it locally by running in through Docker Engine and using the NVIDIA Container Toolkit.</p>
<p>In order for the image to have access to the local display, you need to add it to xhost.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xhost +local:root
</span></span></code></pre></div><p>To launch the simulation through Docker, run the following command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --rm --network<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bridge&#34;</span> --gpus all -e DISPLAY<span style="color:#f92672">=</span>:1 -v /tmp/.X11-unix:/tmp/.X11-unix -it my_robot_simulation:latest /data/workspace/Simulation/MyRobotSimulation.GameLauncher
</span></span></code></pre></div><p>While the simulation is running from the Docker Image, you can now connect to it through ROS2 using the sample navigation example from the MyRobotSimulation project (as described in the previous blog). Open up a new terminal and enter the following lines.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ~/O3DE/Projects/MyRobotSimulation/Examples
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ros2 launch slam_navigation/launch/navigation.launch.py
</span></span></code></pre></div><h2 id="publish-the-docker-image">Publish the Docker Image</h2>
<p>Docker images do not upload to a repository the same way as regular files or archives do. Instead, they rely on OCI-Compliant container registries. For this example, we will use <a href="https://aws.amazon.com/ecr/">Amazon Elastic Container Registry</a> to upload and distribute our Docker image.</p>
<blockquote>
<p><strong>Note</strong>: As with the AWS EC2 instance from the previously blog, we will be using the same Amazon account login for ECR</p>
</blockquote>
<p>Before starting, make sure that you have the <a href="https://aws.amazon.com/cli/">AWS CLI</a> installed</p>
<pre tabindex="0"><code>sudo apt  install awscli
</code></pre><p>Make sure that you have your AWS credentials and region setup running <code>aws configure</code></p>
<h4 id="1-create-a-repository-called-my_robot_simulation">1. Create a repository called <strong>my_robot_simulation</strong></h4>
<p>Run the following command from the terminal to create a repository called &lsquo;my_robot_simulation&rsquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecr create-repository --repository-name my_robot_simulation
</span></span></code></pre></div><blockquote>
<p><strong>Note</strong>: Docker enforces a strict naming convention, and does not allow for mixed casing in the name.</p>
</blockquote>
<p>You should get a response similar to the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;repository&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repositoryArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:ecr:us-west-2:000000000000:repository/my_robot_simulation&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;registryId&#34;</span>: <span style="color:#e6db74">&#34;000000000000&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repositoryName&#34;</span>: <span style="color:#e6db74">&#34;my_robot_simulation&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repositoryUri&#34;</span>: <span style="color:#e6db74">&#34;000000000000.dkr.ecr.us-west-2.amazonaws.com/my_robot_simulation&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;createdAt&#34;</span>: <span style="color:#ae81ff">1734476138.426</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;imageTagMutability&#34;</span>: <span style="color:#e6db74">&#34;MUTABLE&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;imageScanningConfiguration&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;scanOnPush&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;encryptionConfiguration&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;encryptionType&#34;</span>: <span style="color:#e6db74">&#34;AES256&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Note the <code>repositoryUri</code> value and set it to an environment variable for convenience</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export ECR_SIMULATION_URI<span style="color:#f92672">=</span>000000000000.dkr.ecr.us-west-2.amazonaws.com/my_robot_simulation
</span></span></code></pre></div><h4 id="2-log-into-amazon-ecr-with-the-following-command">2. Log into Amazon ECR with the following command</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecr get-login-password | docker login --username AWS --password-stdin $ECR_SIMULATION_URI
</span></span></code></pre></div><p>You should see a message saying <code>Login Succeeded</code></p>
<h4 id="3-tag-the-local-docker-image-for-the-simulation-to-the-repository-uri">3. Tag the local Docker Image for the simulation to the repository URI</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker tag my_robot_simulation $ECR_SIMULATION_URI
</span></span></code></pre></div><h4 id="4-push-the-local-docker-image-to-the-amazon-ecr-for-your-account">4. Push the local Docker Image to the Amazon ECR for your account.</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker push $ECR_SIMULATION_URI
</span></span></code></pre></div><p>This will begin the process to push the Docker Image to ECR. Once the process is done, you can view and verify that the image has been uploaded to your account. Log into your AWS console and go to the Amazon ECR dashboard, and click on <strong>Repositories</strong>. You should see the new <strong>my_robot_simulation</strong> repository under <strong>Private repositories</strong>.</p>
<p><img src="/images/blog/o3de-ros2-export-project/aws-console-amazon-ecr-repos.png" alt="Export Linux"></p>
<h2 id="running-docker-image-on-other-machines">Running Docker Image on other machines</h2>
<p>With the Docker Image stored in your Amazon ECR account, you can distribute and run the image on any Linux host provided that it has Docker or any OCI compliant runtime package as well as the AWS CLI installed. For this example, we will continue to use Docker Engine but from a different Ubuntu Linux host.</p>
<p>You will need to authenticate to the AWS account where the Image has been uploaded and registered to. The user or IAM must have the right permission to pull and run the image. Also, the repository URI from the publish steps above is needed to identify the Image to download. You can also get the URI from the AWS console.</p>
<h4 id="1-set-the-repository-uri-and-log-into-aws">1. Set the Repository URI and log into AWS</h4>
<p>For convenience, set an environment variable to the URI.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export ECR_SIMULATION_URI<span style="color:#f92672">=</span>857350499302.dkr.ecr.us-west-2.amazonaws.com/my_robot_simulation
</span></span></code></pre></div><p>Once logged into your AWS account using the same <code>aws configure</code> steps above, you can pull the Docker Image based on the repository URI.
Then get the login password for your ECR and send it to the docker login</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecr get-login-password | docker login --username AWS --password-stdin $ECR_SIMULATION_URI
</span></span></code></pre></div><h4 id="2-pull-the-docker-image">2. Pull the docker image</h4>
<p>Pull the Docker Image from ECR to the local Docker Engine. This will make the Image ready to run.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker pull $ECR_SIMULATION_URI:latest
</span></span></code></pre></div><blockquote>
<p><strong>Note</strong>: If this step is omitted, the first attempt to run the image will perform the pull operation anyways.</p>
</blockquote>
<h4 id="3-launch-the-docker-image">3. Launch the Docker Image</h4>
<p>Once the Docker Image is pulled to your local Docker Engine, launch the image the same way as described earlier when testing the image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xhost +local:root
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker run --rm --network<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bridge&#34;</span> --gpus all -e DISPLAY<span style="color:#f92672">=</span>:1 -v /tmp/.X11-unix:/tmp/.X11-unix -it $ECR_SIMULATION_URI:latest /data/workspace/Simulation/MyRobotSimulation.GameLauncher
</span></span></code></pre></div><p>This will launch the simulation from the docker image using the environment defined in the Dockerfile recipe. Since we are running on a different machine that does not have the original MyRobotSimulation project, you will need to do one of two things:</p>
<ol>
<li>Copy the Examples/template folder to this machine</li>
<li>Download it from the project template at <a href="https://github.com/o3de/o3de-extras/tree/d2888c1be6f339d323316f46633d46e35816864d/Templates/Ros2ProjectTemplate/Template/Examples">https://github.com/o3de/o3de-extras/tree/d2888c1be6f339d323316f46633d46e35816864d/Templates/Ros2ProjectTemplate/Template/Examples</a> and follow the instructions from the <a href="https://spham-amzn.github.io/posts/o3de-ros2-aws-mp-ami/">previous blog</a> (Step 6: Setup and launch RViz).</li>
</ol>
<h1 id="tearing-down">Tearing Down</h1>
<p>Once we are done with distributing the simulation, we can remove it from Amazon ECR. The cost that Amazon ECR incurs is based on the storage that is used by the Docker Image ( $0.10 USD per GB/Month).  The image constructed with this blog takes up about 1.7 GB of storage, which translates to about $0.17 USD per month. To delete the ECR image, log back into your AWS console and navigate to the Amazon ECR dash board. Locate the <code>my_robot_simulation</code> under <strong>Private registry</strong>-&gt;<strong>Repositories</strong>. Select it and click the <strong>Delete</strong> button.</p>
<h1 id="conclusion">Conclusion</h1>
<p>In this blog we introduced a portable and consistent approach to distributing an O3DE simulation project to different machines. We took a sample robotic simulation project we created in a <a href="https://spham-amzn.github.io/posts/o3de-ros2-aws-mp-ami/">previous blog</a> and exported the simulation as a separate package. We used this exported package to build an OCI compliant container image using Docker Engine and published it to a container registry using Amazon ECR. Finally we demonstrated how to pull and run the simulation docker image using Docker Engine and NVIDIA container toolkit.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
